2025-07-03 01:40:09,145 - RandomForest - INFO - ===== 学业困难学生识别 - 随机森林算法 (SHAP修复版) =====
2025-07-03 01:40:09,145 - RandomForest - INFO - 加载预处理数据...
2025-07-03 01:40:09,337 - RandomForest - INFO - 数据加载成功，形状: (31482, 62)
2025-07-03 01:40:09,338 - RandomForest - INFO - 检查并转换分类变量...
2025-07-03 01:40:09,338 - RandomForest - INFO - 准备特征和目标变量...
2025-07-03 01:40:09,339 - RandomForest - INFO - 训练时已去除final_result列，防止信息泄露。
2025-07-03 01:40:09,346 - RandomForest - INFO - 学业困难学生比例: 53.45% (16827/31482)
2025-07-03 01:40:09,346 - RandomForest - INFO - 划分训练集和测试集 (80:20)...
2025-07-03 01:40:09,371 - RandomForest - INFO - 训练集: 25185 样本
2025-07-03 01:40:09,372 - RandomForest - INFO - 测试集: 6297 样本
2025-07-03 01:40:09,372 - RandomForest - INFO - 标准化特征数据...
2025-07-03 01:40:09,412 - RandomForest - INFO - 开始GridSearchCV自动调参...
2025-07-03 01:44:37,413 - RandomForest - INFO - GridSearchCV调参完成，最佳参数: {'max_depth': 12, 'max_features': 'sqrt', 'min_samples_leaf': 2, 'min_samples_split': 2, 'n_estimators': 200}
2025-07-03 01:44:37,521 - RandomForest - INFO - 最佳模型已保存至: ../outputs/RandomForest/academic_risk_rf_model.pkl
2025-07-03 01:44:37,521 - RandomForest - INFO - 评估模型性能...
2025-07-03 01:44:38,258 - RandomForest - INFO - 评估完成，耗时: 0.74秒
2025-07-03 01:44:38,258 - RandomForest - INFO - 
==================== 模型性能指标 ====================
2025-07-03 01:44:38,259 - RandomForest - INFO - 准确率 (Accuracy): 0.9046
2025-07-03 01:44:38,259 - RandomForest - INFO - 精确率 (Precision): 0.9591
2025-07-03 01:44:38,259 - RandomForest - INFO - 召回率 (Recall): 0.8580
2025-07-03 01:44:38,259 - RandomForest - INFO - F1分数 (F1-Score): 0.9058
2025-07-03 01:44:38,259 - RandomForest - INFO - ROC AUC分数: 0.9602
2025-07-03 01:44:38,259 - RandomForest - INFO - 
==================== 混淆矩阵 ====================
2025-07-03 01:44:38,259 - RandomForest - INFO - 
[[2808  123]
 [ 478 2888]]
2025-07-03 01:44:38,259 - RandomForest - INFO - 
==================== 分类报告 ====================
2025-07-03 01:44:38,259 - RandomForest - INFO - 
              precision    recall  f1-score   support

        正常学生       0.85      0.96      0.90      2931
      学业困难学生       0.96      0.86      0.91      3366

    accuracy                           0.90      6297
   macro avg       0.91      0.91      0.90      6297
weighted avg       0.91      0.90      0.90      6297

2025-07-03 01:44:38,268 - RandomForest - INFO - 评估指标已保存至: ../outputs/RandomForest\metrics.csv
2025-07-03 01:44:38,268 - RandomForest - INFO - 使用SHAP进行特征解释分析...
2025-07-03 01:44:38,269 - RandomForest - INFO - 初始化SHAP解释器...
2025-07-03 01:44:38,367 - RandomForest - INFO - 计算 1000 个样本的SHAP值...
2025-07-03 01:46:59,279 - RandomForest - INFO - SHAP值形状: (1000, 60, 2)
2025-07-03 01:46:59,282 - RandomForest - INFO - 数据形状: (1000, 60)
2025-07-03 01:46:59,282 - RandomForest - INFO - 使用正类SHAP值，新形状: (1000, 60)
2025-07-03 01:47:01,399 - RandomForest - INFO - 
==================== SHAP特征分析结果 ====================
2025-07-03 01:47:01,399 - RandomForest - INFO - SHAP摘要图已保存至: ../outputs/RandomForest/shap_results\shap_summary.png
2025-07-03 01:47:01,399 - RandomForest - INFO - SHAP条形图已保存至: ../outputs/RandomForest/shap_results\shap_bar.png
2025-07-03 01:47:01,399 - RandomForest - INFO - SHAP依赖图已保存至: ../outputs/RandomForest/shap_results\shap_dependence_date_unregistration.png
2025-07-03 01:47:01,399 - RandomForest - INFO - SHAP依赖图已保存至: ../outputs/RandomForest/shap_results\shap_dependence_active_days_homepage.png
2025-07-03 01:47:01,399 - RandomForest - INFO - SHAP依赖图已保存至: ../outputs/RandomForest/shap_results\shap_dependence_overall_active_days.png
2025-07-03 01:47:01,399 - RandomForest - INFO - 
Top 10 重要特征 (基于SHAP值):
2025-07-03 01:47:01,403 - RandomForest - INFO -                  Feature  Mean |SHAP|
12   date_unregistration     0.090108
20  active_days_homepage     0.065534
57   overall_active_days     0.043160
48     total_clicks_quiz     0.038128
59      early_engagement     0.037170
56  overall_total_clicks     0.020703
28      active_days_quiz     0.019908
0            code_module     0.019739
30  active_days_resource     0.017065
32   active_days_subpage     0.015504
2025-07-03 01:47:01,403 - RandomForest - INFO - 
重要特征解释:
2025-07-03 01:47:01,403 - RandomForest - INFO - - date_unregistration: 课程退课日期，可能与学业困难相关
2025-07-03 01:47:01,403 - RandomForest - INFO - - active_days_homepage: 访问课程主页的天数，反映基本参与程度
2025-07-03 01:47:01,403 - RandomForest - INFO - - overall_active_days: 学生与学习平台互动的总天数，高值表示更活跃的学生
2025-07-03 01:47:01,403 - RandomForest - INFO - - total_clicks_quiz: 重要行为特征
2025-07-03 01:47:01,403 - RandomForest - INFO - - early_engagement: 课程前4周的平均参与度，是早期预警的关键指标
2025-07-03 01:47:01,403 - RandomForest - INFO - 
===== 随机森林模型总结 =====
2025-07-03 01:47:01,403 - RandomForest - INFO - 学业困难学生识别率 (召回率): 85.80%
2025-07-03 01:47:01,403 - RandomForest - INFO - 模型准确率: 90.46%
2025-07-03 01:47:01,404 - RandomForest - INFO - F1分数: 0.9058
2025-07-03 01:47:01,404 - RandomForest - INFO - ROC AUC: 0.9602
2025-07-03 01:47:01,404 - RandomForest - INFO - 学业困难学生识别任务完成!
